# الشات بوت الذكي - البحث في جميع البيانات

## نظرة عامة
تم تطوير نظام شات بوت ذكي يستخدم تقنية الـ Embeddings للبحث في جميع البيانات في قاعدة البيانات، وليس المنتجات فقط.

## الميزات الجديدة

### 1. البحث الشامل
الشات بوت الآن يبحث في:
- **المنتجات**: اسم المنتج، الوصف، السعر
- **العلامات التجارية**: اسم العلامة، الوصف، العنوان، الفئة
- **الفئات**: اسم الفئة
- **الطلبات**: رقم الطلب، التاريخ، الحالة، المبلغ، طريقة الدفع
- **المراجعات**: التعليق، التقييم

### 2. إنشاء Embeddings لجميع البيانات
تم إضافة وظيفة جديدة لإنشاء embeddings لجميع البيانات في قاعدة البيانات.

## كيفية الاستخدام

### 1. إنشاء Embeddings لجميع البيانات
```http
POST /api/Chat/index-all-data
```

### 2. إنشاء Embeddings للمنتجات فقط (للتوافق مع الكود القديم)
```http
POST /api/Chat/index-data
```

### 3. طرح سؤال على الشات بوت
```http
POST /api/Chat/ask
Content-Type: application/json

{
    "question": "ما هي أفضل المنتجات في فئة الإلكترونيات؟"
}
```

### 4. اختبار الاتصال بـ Gemini API
```http
GET /api/Chat/test-api
```

## أمثلة على الأسئلة

### أسئلة عن المنتجات
- "ما هي المنتجات المتاحة في فئة الملابس؟"
- "أريد منتجات بسعر أقل من 100 جنيه"
- "ما هي أفضل المنتجات تقييماً؟"

### أسئلة عن العلامات التجارية
- "ما هي العلامات التجارية في فئة الإلكترونيات؟"
- "أين توجد علامة تجارية معينة؟"
- "ما هي العلامات التجارية الأكثر شعبية؟"

### أسئلة عن الطلبات
- "ما هي حالة طلبي؟"
- "كم عدد الطلبات المعلقة؟"
- "ما هي الطلبات التي تمت في الشهر الماضي؟"

### أسئلة عن المراجعات
- "ما هي آراء العملاء في هذا المنتج؟"
- "ما هو متوسط التقييم للمنتجات؟"
- "ما هي أفضل المراجعات؟"

## التحديثات التقنية

### 1. إضافة حقول Embedding
تم إضافة حقل `Embedding` من نوع `GeoPoint` لجميع النماذج:
- `Brand`
- `Category`
- `Order`
- `Review`

### 2. تحديث EmbeddingService
- إضافة وظيفة `IndexAllData()` لإنشاء embeddings لجميع البيانات
- تحديث `FindMostRelevantContext()` للبحث في جميع الجداول
- إضافة وظائف خاصة لكل نوع من البيانات

### 3. تحديث ChatController
- إضافة endpoint جديد `/index-all-data`
- الحفاظ على التوافق مع الكود القديم

## كيفية التشغيل

1. تأكد من وجود مفتاح API صحيح لـ Gemini في `appsettings.json`
2. قم بتشغيل التطبيق
3. استدعي endpoint إنشاء embeddings:
   ```http
   POST /api/Chat/index-all-data
   ```
4. ابدأ في طرح الأسئلة على الشات بوت

## ملاحظات مهمة

- تأكد من وجود بيانات في قاعدة البيانات قبل إنشاء embeddings
- قد يستغرق إنشاء embeddings وقتاً طويلاً حسب كمية البيانات
- الشات بوت يجيب فقط بناءً على البيانات الموجودة في قاعدة البيانات
- يتم البحث في جميع الجداول وتقديم أفضل النتائج ذات الصلة

## استكشاف الأخطاء

### إذا لم يتم العثور على نتائج
- تأكد من إنشاء embeddings للبيانات
- تحقق من وجود بيانات في قاعدة البيانات
- تأكد من صحة مفتاح API لـ Gemini

### إذا فشل إنشاء embeddings
- تحقق من اتصال الإنترنت
- تأكد من صحة مفتاح API
- راجع سجلات التطبيق للأخطاء 